{% load static %} {% include "admin/charts/boilerplate.html" %}
<link
  id="themecss"
  rel="stylesheet"
  type="text/css"
  href="//www.shieldui.com/shared/components/latest/css/light/all.min.css"
/>
<script
  type="text/javascript"
  src="//www.shieldui.com/shared/components/latest/js/jquery-1.11.1.min.js"
></script>
<script
  type="text/javascript"
  src="//www.shieldui.com/shared/components/latest/js/shieldui-all.min.js"
></script>
<body class="theme-light">
  <div id="temp" class="chart"></div>
  <div id="hum" class="chart"></div>
  <div id="aqi" class="chart"></div>
  <script type="text/javascript">
    jQuery(function($) {
      var temp = new Array();
      var hum = new Array();
      var aqi = new Array();
      var lab = new Array();
      $("#temp").shieldChart({
        theme: "light",
        applyAnimation: false,
        exportOptions: {
          image: false,
          print: false
        },
        tooltipSettings: {
          enabled: false
        },
        seriesSettings: {
          line: {
            applyAnimation: false,
            pointMark: {
              enabled: false
            }
          }
        },
        axisX: {
          min: 0,
          max: 55
        },
        primaryHeader: {
          text: "temperature"
        },
        dataSeries: [
          {
            seriesType: "line",
            collectionAlias: "Temperature in celcius",
            data: temp
          }
        ]
      });
      $("#hum").shieldChart({
        theme: "light",
        applyAnimation: false,
        exportOptions: {
          image: false,
          print: false
        },
        tooltipSettings: {
          enabled: false
        },
        seriesSettings: {
          line: {
            applyAnimation: false,
            pointMark: {
              enabled: false
            }
          }
        },
        axisX: {
          min: 0,
          max: 55
        },
        primaryHeader: {
          text: "Humidity"
        },
        dataSeries: [
          {
            seriesType: "line",
            collectionAlias: "Humidity in %",
            data: hum
          }
        ]
      });
      $("#aqi").shieldChart({
        theme: "light",
        applyAnimation: false,
        exportOptions: {
          image: false,
          print: false
        },
        tooltipSettings: {
          enabled: false
        },
        seriesSettings: {
          line: {
            applyAnimation: false,
            pointMark: {
              enabled: false
            }
          }
        },
        axisX: {
          min: 0,
          max: 55
        },
        primaryHeader: {
          text: "Air Quality"
        },
        dataSeries: [
          {
            seriesType: "line",
            collectionAlias: "Air Quality Index",
            data: aqi
          }
        ]
      });

      setInterval(function() {
        $.ajax({
          url:
            "https://api.thingspeak.com/channels/1017900/feeds/last?api_key=CQ98H95JG2IBYHNH",
          dataType: "json",
          success: function(data) {
            console.log(data);
            console.log(temp.length);
            temp[temp.length] = parseFloat(data["field1"]);
            hum[hum.length] = parseFloat(data["field2"]);
            aqi[aqi.length] = parseFloat(data["field3"]);
            lab[lab.length] = parseInt(data["field4"]);

            if (temp.length > 50) {
              temp = temp.splice(1, 49);
            }
            if (hum.length > 50) {
              hum = hum.splice(1, 49);
            }
            if (aqi.length > 50) {
              hum = hum.splice(1, 49);
            }
            if (lab.length > 50) {
              lab = lab.splice(1, 49);
            }

            var container = $("#temp").swidget();
            if (container) {
              container.destroy();
            }
            var container = $("#hum").swidget();
            if (container) {
              container.destroy();
            }

            var container = $("#aqi").swidget();
            if (container) {
              container.destroy();
            }
            $("#temp").shieldChart({
              theme: "light",
              applyAnimation: false,
              seriesSettings: {
                line: {
                  applyAnimation: false,
                  pointMark: {
                    enabled: false
                  }
                }
              },
              tooltipSettings: {
                enabled: false
              },
              exportOptions: {
                image: false,
                print: false
              },
              axisX: {
                min: 0,
                max: 55
              },
              primaryHeader: {
                text: "temperature"
              },
              dataSeries: [
                {
                  seriesType: "line",
                  collectionAlias: "Temperature in celcius",
                  data: temp
                }
              ]
            });
            $("#hum").shieldChart({
              theme: "light",
              applyAnimation: false,
              seriesSettings: {
                line: {
                  applyAnimation: false,
                  pointMark: {
                    enabled: false
                  }
                }
              },
              tooltipSettings: {
                enabled: false
              },
              exportOptions: {
                image: false,
                print: false
              },
              axisX: {
                min: 0,
                max: 55
              },
              primaryHeader: {
                text: "Humidity"
              },
              dataSeries: [
                {
                  seriesType: "line",
                  collectionAlias: "HUmidity in %",
                  data: hum
                }
              ]
            });
            $("#aqi").shieldChart({
              theme: "light",
              applyAnimation: false,
              exportOptions: {
                image: false,
                print: false
              },
              tooltipSettings: {
                enabled: false
              },
              seriesSettings: {
                line: {
                  applyAnimation: false,
                  pointMark: {
                    enabled: false
                  }
                }
              },
              axisX: {
                min: 0,
                max: 55
              },
              primaryHeader: {
                text: "Air Quality"
              },
              dataSeries: [
                {
                  seriesType: "line",
                  collectionAlias: "Air Quality Index",
                  data: aqi
                }
              ]
            });
          }
        });
      }, 5000);
    });
  </script>
  <style scoped>
    .chart {
      width: 33%;
      display: inline-block;
      *display: inline;
      zoom: 1;
    }
  </style>
</body>
