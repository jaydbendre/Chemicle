{% load static %} {% include "admin/charts/boilerplate.html" %}
<link
  id="themecss"
  rel="stylesheet"
  type="text/css"
  href="//www.shieldui.com/shared/components/latest/css/light/all.min.css"
/>
<script
  type="text/javascript"
  src="//www.shieldui.com/shared/components/latest/js/jquery-1.11.1.min.js"
></script>
<script
  type="text/javascript"
  src="//www.shieldui.com/shared/components/latest/js/shieldui-all.min.js"
></script>
<body class="theme-light">
  <div id="temp2" class="chart"></div>
  <div id="hum2" class="chart"></div>
  <div id="aqi2" class="chart"></div>
  <script type="text/javascript">
    jQuery(function($) {
      var temp1 = new Array();
      var hum1 = new Array();
      var aqi1 = new Array();
      var lab1 = new Array();
      $("#temp2").shieldChart({
        theme: "light",
        applyAnimation: false,
        exportOptions: {
          image: false,
          print: false
        },
        tooltipSettings: {
          enabled: false
        },
        seriesSettings: {
          line: {
            applyAnimation: false,
            pointMark: {
              enabled: false
            }
          }
        },
        axisX: {
          min: 0,
          max: 55
        },
        primaryHeader: {
          text: "temperature"
        },
        dataSeries: [
          {
            seriesType: "line",
            collectionAlias: "Temperature in celcius",
            data: temp1
          }
        ]
      });
      $("#hum2").shieldChart({
        theme: "light",
        applyAnimation: false,
        exportOptions: {
          image: false,
          print: false
        },
        tooltipSettings: {
          enabled: false
        },
        seriesSettings: {
          line: {
            applyAnimation: false,
            pointMark: {
              enabled: false
            }
          }
        },
        axisX: {
          min: 0,
          max: 55
        },
        primaryHeader: {
          text: "Humidity"
        },
        dataSeries: [
          {
            seriesType: "line",
            collectionAlias: "Humidity in %",
            data: hum1
          }
        ]
      });
      $("#aqi2").shieldChart({
        theme: "light",
        applyAnimation: false,
        exportOptions: {
          image: false,
          print: false
        },
        tooltipSettings: {
          enabled: false
        },
        seriesSettings: {
          line: {
            applyAnimation: false,
            pointMark: {
              enabled: false
            }
          }
        },
        axisX: {
          min: 0,
          max: 55
        },
        primaryHeader: {
          text: "Air Quality"
        },
        dataSeries: [
          {
            seriesType: "line",
            collectionAlias: "Air Quality Index",
            data: aqi1
          }
        ]
      });

      setInterval(function() {
        $.ajax({
          url:
            "https://api.thingspeak.com/channels/1017900/feeds/last?api_key=CQ98H95JG2IBYHNH",
          dataType: "json",
          success: function(data) {
            
            if(data["field4"]==1004){
                console.log(data);
                temp1[temp1.length] = parseFloat(data["field1"]);
                hum1[hum1.length] = parseFloat(data["field2"]);
                aqi1[aqi1.length] = parseFloat(data["field3"]);
                lab1[lab1.length] = parseInt(data["field4"]);
            
                if (temp1.length > 50) {
                temp1 = temp1.splice(1, 49);
                }
                if (hum1.length > 50) {
                hum1 = hum1.splice(1, 49);
                }
                if (aqi1.length > 50) {
                aqi1 = aqi1.splice(1, 49);
                }
                if (lab1.length > 50) {
                lab1 = lab1.splice(1, 49);
                }

                var container = $("#temp2").swidget();
                if (container) {
                container.destroy();
                }
                var container = $("#hum2").swidget();
                if (container) {
                container.destroy();
                }

                var container = $("#aqi2").swidget();
                if (container) {
                container.destroy();
                }
                $("#temp2").shieldChart({
                theme: "light",
                applyAnimation: false,
                seriesSettings: {
                    line: {
                    applyAnimation: false,
                    pointMark: {
                        enabled: false
                    }
                    }
                },
                tooltipSettings: {
                    enabled: false
                },
                exportOptions: {
                    image: false,
                    print: false
                },
                axisX: {
                    min: 0,
                    max: 55
                },
                primaryHeader: {
                    text: "temperature"
                },
                dataSeries: [
                    {
                    seriesType: "line",
                    collectionAlias: "Temperature in celcius",
                    data: temp1
                    }
                ]
                });
                $("#hum2").shieldChart({
                theme: "light",
                applyAnimation: false,
                seriesSettings: {
                    line: {
                    applyAnimation: false,
                    pointMark: {
                        enabled: false
                    }
                    }
                },
                tooltipSettings: {
                    enabled: false
                },
                exportOptions: {
                    image: false,
                    print: false
                },
                axisX: {
                    min: 0,
                    max: 55
                },
                primaryHeader: {
                    text: "Humidity"
                },
                dataSeries: [
                    {
                    seriesType: "line",
                    collectionAlias: "HUmidity in %",
                    data: hum1
                    }
                ]
                });
                $("#aqi2").shieldChart({
                theme: "light",
                applyAnimation: false,
                exportOptions: {
                    image: false,
                    print: false
                },
                tooltipSettings: {
                    enabled: false
                },
                seriesSettings: {
                    line: {
                    applyAnimation: false,
                    pointMark: {
                        enabled: false
                    }
                    }
                },
                axisX: {
                    min: 0,
                    max: 55
                },
                primaryHeader: {
                    text: "Air Quality"
                },
                dataSeries: [
                    {
                    seriesType: "line",
                    collectionAlias: "Air Quality Index",
                    data: aqi1
                    }
                ]
                });
            }
          }
        });
      }, 2000);
    });
  </script>
  <style scoped>
    .chart {
      width: 33%;
      display: inline-block;
      *display: inline;
      zoom: 1;
    }
  </style>
</body>
